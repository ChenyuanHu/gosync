# GoSync - 多机文件同步工具

GoSync是一个简单高效的命令行工具，用于在多台机器之间同步文件。它会比较各节点上的文件，并确保所有节点上的文件保持一致。适合局域网环境下的多机文件快速同步。

## 功能特点

- 多节点文件同步，支持任意数量的节点
- 自动识别并同步新增文件
- 支持目录结构同步
- 以文件名作为判断文件是否一致的标准
- 智能处理节点离线情况，保证集群整体同步完成
- 全部节点文件一致后自动退出

## 安装

### 前提条件

- 确保已安装Go环境(Go 1.13+)

### 编译方法

```bash
# 克隆仓库后进入项目目录
chmod +x build.sh
./build.sh
```

这将生成一个名为`gosync`的可执行文件。

## 使用方法

```bash
./gosync -dir=<要同步的目录> -peers=<对等节点IP列表,以逗号分隔> [-port=<端口号>] [-delay=<同步完成后等待时间>]
```

### 参数说明

- `-dir`: 要同步的目录路径 (必需)
- `-peers`: 对等节点的IP地址，用逗号分隔 (必需)
- `-port`: 服务器监听端口 (可选，默认为18283)
- `-delay`: 同步完成后等待时间，单位秒 (可选，默认为10秒)

### 重要提示

- 可以在所有节点上使用相同的peers列表(包括自己的IP)，程序会自动处理
- 同一个集群中的所有节点必须使用相同的端口

## 使用示例

假设有三台机器，IP分别为192.168.1.101、192.168.1.102和192.168.1.103，在所有三台机器上都执行相同的命令：

```bash
./gosync -dir=/path/to/sync/folder -peers=192.168.1.101,192.168.1.102,192.168.1.103
```

这样配置非常简单，不需要为每台机器单独调整命令参数。

## 工作原理

1. 程序启动后会在指定端口启动HTTP服务器
2. 扫描本地目录，建立文件列表
3. 与每个对等节点通信，比较文件列表
4. 下载对方有而自己没有的文件
5. 将自己有而对方没有的文件推送给对方
6. 智能处理节点离线情况，确保整个集群最终同步完成
7. 所有节点文件一致后，程序会等待指定的延迟时间再退出(给其他节点完成同步的时间)

## 注意事项

- 该工具只处理文件新增，不处理文件删除
- 文件比较仅基于文件名，不检查文件内容或修改时间
- 所有节点必须能够相互访问网络
- 建议在局域网环境中使用，以获得更好的传输速度
- 如果文件很大或节点很多，可能需要增加`-delay`参数的值

## 故障排除

- 如果同步失败，检查防火墙是否允许指定端口的TCP连接
- 确保所有节点都能相互ping通
- 检查磁盘空间是否充足
- 如果文件过多，可能需要增加最大同步尝试次数(在代码中修改maxAttempts变量)

## 贡献

欢迎提交问题报告和功能建议。

## 作者

此代码由Claude人工智能助手生成，并根据用户需求进行了优化和调整。

## 许可证

MIT 